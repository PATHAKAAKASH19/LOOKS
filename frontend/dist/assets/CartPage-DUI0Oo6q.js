import{f as X,r as i,u as Y,h as ee,g as se,j as s,S as ae,C as r,i as te,k as re,L as ne,n as o}from"./index-DdXbiFkB.js";import{I as y}from"./InputBox-CRXJ9-E-.js";import{T as oe}from"./Title-XAzlc8PW.js";import{R as ie}from"./index-D4YCy08t.js";import{C as _}from"./index-4Lv3Bh_E.js";import{A as ce}from"./AddressForm-DALxxGwT.js";import"./index-D95-s8ii.js";function ye(){const J=X(),[u,q]=i.useState({editEmail:!1,editAddress:!1,editPhoneNo:!1}),[b,P]=i.useState(""),[C,x]=i.useState(""),[N,w]=i.useState({shippingAmount:"",productAmount:"",netAmount:""}),[K,U]=i.useState(!1),[d,O]=i.useState([]),[f,$]=i.useState({name:"",email:"",phoneNo:""}),[S,v]=i.useState(null),[g,z]=i.useState([]),{accessToken:c,setAccessToken:B}=Y(),{cartInfo:E,setCartInfo:F}=ee(),{userInfo:p,setUserInfo:D}=se(),H=e=>Object.entries(e).filter(([t])=>t!=="_id").map(([,t])=>t).join(", "),G=async(e,a)=>{try{if(e.phoneNo,e.email,C){const t=a.filter(j=>C===j._id),{_id:n,...A}=t[0],h=await(await fetch("http://localhost:3000/api/order/checkout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({address:A})})).json(),m={key:"rzp_test_QoUrFERqmNoDNk",amount:h.amount,currency:"INR",name:"Looks Pvt Ltd",description:"Test Transction",order_id:h.razorpayOrderId,handler:async function(j){try{console.log(h);const I=await fetch(`http://localhost:3000/api/order/verify/${h.orderId}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({order_id:j.razorpay_order_id,payment_id:j.razorpay_payment_id,signature:j.razorpay_signature})}),W=await I.json();I.status===200?J(`/paymentSuccess?reference=${W.orderId}`):o.error("Payment failed, retry")}catch(I){console.log("Error",I),o.error("Please try again")}},prefill:{name:`${e.name}`,email:`${e.email}`,contact:`${e.phoneNo}`},notes:{orderId:`${h.orderId}`,customerId:`${e._id}`},theme:{color:"#528FF0"}};new window.Razorpay(m).open()}else o.error("Please fill email, phoneNo and address")}catch(t){console.log("error",t),o.error("Could not initiate payment. Please try again.")}},Q=async(e,a)=>{try{const t=await fetch("http://localhost:3000/api/cart/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({productId:e,size:a,quantity:1})}),{cart:n}=await t.json();t.status===200&&n!==null?(F(n),o.success("size updated successfully")):n===null&&o.error("select different size")}catch(t){o.error("error : ",t)}},Z=async e=>{try{const a=await fetch("http://localhost:3000/api/cart/",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({productId:e})}),t=await a.json();a.status===200&&(F(t.cart),o.success(`${t.message}`))}catch(a){console.log("error",a),o.error("please delete again")}};i.useEffect(()=>{if(d&&d.length>0){const e=[];d.forEach(t=>{var n;e.push((n=t.productId)==null?void 0:n.price)});const a=e.reduce((t,n)=>t+n);a<=499?w({shippingAmount:"inr 150",productAmount:`${a}`,netAmount:`${Number(a)+150}`}):w({shippingAmount:"FREE",productAmount:`${a}`,netAmount:`${a}`})}},[d]),i.useEffect(()=>{var e;if(c&&E&&p){U(!0);const{address:a,wishlist:t,...n}=p;O(E.products),$({...n}),z(a),x((e=p==null?void 0:p.address[0])==null?void 0:e._id),U(!1)}else O([]),$({name:"",email:"",phoneNo:""}),z([]),x(null)},[c,E,p,d]);const l=(e,a)=>{q(t=>({...t,[e]:!t[e]})),a?(v(a),P(`${a._id}`)):(v(null),P(""))},L=e=>{$(a=>({...a,[e.target.name]:e.target.value}))},M=async e=>{var a;try{e.preventDefault();const t=await fetch("http://localhost:3000/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({address:S,addressAction:"save"})}),{userData:n}=await t.json();t.status===200&&(z(n.address),l("editAddress"),o.success("address created successfully"),x((a=n.address[0])==null?void 0:a._id))}catch(t){o.error("error:",t)}},V=async e=>{try{e.preventDefault();const a=await fetch("http://localhost:3000/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({address:S,prevAddressId:b})}),{userData:t}=await a.json();a.status===200&&(D(t),l("editAddress"),o.success("address updated successfully"))}catch(a){o.error("error : ",a)}},R=async()=>{try{const e=await fetch("http://localhost:3000/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({email:f.email,phoneNo:f.phoneNo})}),a=await e.json();e.status===200&&(D(a.userData),o.success("userInfo save successfully"),u.editEmail?l("editEmail"):l("editPhoneNo"))}catch(e){o.error("error : ",e)}};return i.useEffect(()=>{!c&&localStorage.getItem("userAccessToken")&&B(localStorage.getItem("userAccessToken"))},[c,B]),i.useEffect(()=>{window.scrollTo(0,0)},[]),s.jsx(s.Fragment,{children:K?s.jsx(ae,{}):d&&d.length>0?s.jsxs(r,{className:"cart-con",children:[s.jsx(te,{}),s.jsxs(r,{className:"cart",children:[s.jsx(r,{className:"product-con",children:d.map(e=>{var a,t,n,A,T,h,k;return s.jsxs(r,{className:"product",children:[s.jsx(r,{className:"imgBox",children:s.jsx("img",{src:`${(a=e==null?void 0:e.productId)==null?void 0:a.productImgUrls[0]}`,alt:`${(t=e==null?void 0:e.productId)==null?void 0:t.name}`})}),s.jsxs(r,{className:"product-info",children:[s.jsx(oe,{title:`${(n=e==null?void 0:e.productId)==null?void 0:n.name.toUpperCase()}`}),s.jsxs(r,{className:"size",children:[s.jsx("label",{htmlFor:"size",children:"SIZE - "}),s.jsx("select",{name:"size",id:"size",value:(A=e==null?void 0:e.size)==null?void 0:A.toUpperCase(),onChange:m=>Q(e==null?void 0:e._id,m.target.value),children:e==null?void 0:e.productId.sizes.map(m=>s.jsx("option",{value:`${m.toUpperCase()}`,children:m},`${m}`))})]}),s.jsxs(r,{className:"cloth-color",children:[s.jsx("h3",{className:"dark",children:"COLOR -"}),s.jsx("h3",{children:(h=(T=e==null?void 0:e.productId)==null?void 0:T.color)==null?void 0:h.toUpperCase()})]}),s.jsxs(r,{className:"p",children:[s.jsx(ie,{className:"delete",onClick:()=>Z(e==null?void 0:e._id)}),s.jsxs("h3",{children:["INR ",(k=e==null?void 0:e.productId)==null?void 0:k.price]})]})]})]},`${e==null?void 0:e._id}`)})}),s.jsx(r,{className:"user-info-container",children:s.jsxs(r,{className:"price-con",children:[s.jsx(r,{className:"price-sub-div",children:s.jsxs("form",{className:"user-info-con",children:[s.jsxs(r,{className:"user-info-field-con",children:[s.jsx("label",{htmlFor:"email-Id",children:"Email"}),s.jsxs(r,{className:"user-info-field",children:[s.jsx(y,{type:"text",name:"email",value:f.email,onChange:L,placeholder:"enter your email",id:"email-Id",disabled:!u.editEmail}),u.editEmail?s.jsx("button",{type:"button",onClick:()=>R(),className:"cart-btn",children:"save"}):s.jsx(_,{onClick:()=>l("editEmail"),className:"cart-icon"})]})]}),s.jsxs(r,{className:"user-info-field-con",children:[s.jsx("label",{htmlFor:"phoneNo",children:"Phone No"}),s.jsxs(r,{className:"user-info-field",children:[s.jsx(y,{type:"text",name:"phoneNo",value:f.phoneNo,onChange:L,placeholder:"enter 10 digit phone no",id:"phoneNo",disabled:!u.editPhoneNo}),u.editPhoneNo?s.jsx("button",{type:"button",onClick:()=>R(),className:"cart-btn",children:"save"}):s.jsx(_,{onClick:()=>l("editPhoneNo"),className:"cart-icon"})]})]}),s.jsxs(r,{className:"user-info-field-con",children:[s.jsxs(r,{className:"address-label-con",children:[s.jsx("label",{htmlFor:"address",children:"delivery Address"}),s.jsx(re,{className:"icon",onClick:()=>l("editAddress")})]}),g&&g.length>0?g.map(e=>s.jsxs(r,{className:"user-info-field",children:[s.jsx(y,{type:"text",name:"address",value:H(e),placeholder:"enter your address",disabled:!0,id:"address"}),s.jsx(_,{onClick:()=>l("editAddress",e),className:"cart-icon"}),s.jsx(r,{className:"radio",children:s.jsx(y,{type:"radio",name:"deliveryAddress",checked:e._id===C,value:e._id,onChange:a=>x(a.target.value)})})]},e._id)):null]})]})}),s.jsxs(r,{className:"sub-con",children:[s.jsxs(r,{className:"discount-box",children:[s.jsx(y,{type:"text",placeholder:"add discount code",name:"discount",required:!0}),s.jsx("button",{className:"discount-btn",children:"apply"})]}),s.jsxs(r,{className:"sub-total",children:[s.jsx("h3",{children:"subtotal"}),s.jsxs("h3",{children:["inr ",N.productAmount]})]}),s.jsxs(r,{className:"shipping-cost",children:[s.jsx("h3",{children:"shipping cost"}),s.jsx("h3",{children:N.shippingAmount})]}),s.jsxs(r,{className:"total",children:[s.jsx("h2",{children:"total"}),s.jsxs("h2",{children:["inr ",N.productAmount]})]})]}),s.jsx("button",{type:"button",className:"checkout-btn",onClick:()=>G(f,g),children:"CHECKOUT"})]})})]}),u.editAddress&&s.jsx(r,{className:"address-form-con1",children:s.jsx(ce,{handleEdit:l,saveAddress:b!==""?V:M,editAddress:b!=="",addressObj:S,setAddress:v})})]}):s.jsxs(r,{className:"empty-cart",children:[s.jsx("h2",{children:"Cart is empty add exciting products"}),s.jsx(ne,{to:"/",className:"empty-cart-link",children:s.jsx("h2",{children:"Go to home page "})})]})})}export{ye as default};
