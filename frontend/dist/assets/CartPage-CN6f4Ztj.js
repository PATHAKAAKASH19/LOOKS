import{a as X,r as o,u as Y,k as Z,i as ee,j as s,S as se,C as r,n as ae,T as te,e as j,p as k,q as re,A as ne,L as ie,o as i}from"./index-Npg09nsS.js";import{R as oe}from"./index-DtTQf1np.js";function me(){const L=X(),[h,R]=o.useState({editEmail:!1,editAddress:!1,editPhoneNo:!1}),[A,w]=o.useState(""),[b,y]=o.useState(""),[x,_]=o.useState({shippingAmount:"",productAmount:"",netAmount:""}),[J,P]=o.useState(!1),[m,O]=o.useState([]),[f,I]=o.useState({name:"",email:"",phoneNo:""}),[$,v]=o.useState(null),[N,C]=o.useState([]),{accessToken:c,setAccessToken:U}=Y(),{cartInfo:S,setCartInfo:z}=Z(),{userInfo:u,setUserInfo:B}=ee(),q=e=>Object.entries(e).filter(([t])=>t!=="_id").map(([,t])=>t).join(", "),K=async(e,a)=>{try{if(e.phoneNo,e.email,b){const t=a.filter(p=>b===p._id),{_id:n,...g}=t[0],d=await(await fetch("http://192.168.0.104:3000/api/order/checkout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({address:g})})).json(),V={key:"rzp_test_QoUrFERqmNoDNk",amount:d.amount,currency:"INR",name:"Looks Pvt Ltd",description:"Test Transction",order_id:d.razorpayOrderId,handler:async function(p){try{const T=await fetch(`http://192.168.0.104:3000/api/order/verify/${d.orderId}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({order_id:p.razorpay_order_id,payment_id:p.razorpay_payment_id,signature:p.razorpay_signature})}),W=await T.json();T.status===200?(z(null),L(`/paymentSuccess?reference=${W.orderId}`)):i.error("Payment failed, retry")}catch{i.error("Please try again")}},prefill:{name:`${e.name}`,email:`${e.email}`,contact:`${e.phoneNo}`},notes:{orderId:`${d.orderId}`,customerId:`${e._id}`},theme:{color:"#528FF0"}};new window.Razorpay(V).open()}else i.error("Please fill email, phoneNo and address")}catch{i.error("Could not initiate payment. Please try again.")}},H=async(e,a)=>{try{const t=await fetch("http://192.168.0.104:3000/api/cart/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({productId:e,size:a,quantity:1})}),{cart:n}=await t.json();t.status===200&&n!==null?(z(n),i.success("size updated successfully")):n===null&&i.error("select different size")}catch(t){i.error("error : ",t)}},G=async e=>{try{const a=await fetch("http://192.168.0.104:3000/api/cart/",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({productId:e})}),t=await a.json();a.status===200&&(z(t.cart),i.success(`${t.message}`))}catch{i.error("please delete again")}};o.useEffect(()=>{if(m&&m.length>0){const e=[];m.forEach(t=>{var n;e.push((n=t.productId)==null?void 0:n.price)});const a=e.reduce((t,n)=>t+n);a<=499?_({shippingAmount:"inr 150",productAmount:`${a}`,netAmount:`${Number(a)+150}`}):_({shippingAmount:"FREE",productAmount:`${a}`,netAmount:`${a}`})}},[m]),o.useEffect(()=>{var e;if(c&&S&&u){P(!0);const{address:a,wishlist:t,...n}=u;O(S.products),I({...n}),C(a),y((e=u==null?void 0:u.address[0])==null?void 0:e._id),P(!1)}else O([]),I({name:"",email:"",phoneNo:""}),C([]),y(null)},[c,S,u]);const l=(e,a)=>{R(t=>({...t,[e]:!t[e]})),a?(v(a),w(`${a._id}`)):(v(null),w(""))},D=e=>{I(a=>({...a,[e.target.name]:e.target.value}))},Q=async e=>{var a;try{e.preventDefault();const t=await fetch("http://192.168.0.104:3000/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({address:$,addressAction:"save"})}),{userData:n}=await t.json();t.status===200&&(C(n.address),l("editAddress"),i.success("address created successfully"),y((a=n.address[0])==null?void 0:a._id))}catch(t){i.error("error:",t)}},M=async e=>{try{e.preventDefault();const a=await fetch("http://192.168.0.104:3000/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({address:$,prevAddressId:A})}),{userData:t}=await a.json();a.status===200&&(B(t),l("editAddress"),i.success("address updated successfully"))}catch(a){i.error("error : ",a)}},F=async()=>{try{const e=await fetch("http://192.168.0.104:3000/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({email:f.email,phoneNo:f.phoneNo})}),a=await e.json();e.status===200&&(B(a.userData),i.success("userInfo save successfully"),h.editEmail?l("editEmail"):l("editPhoneNo"))}catch(e){i.error("error : ",e)}};return o.useEffect(()=>{!c&&localStorage.getItem("userAccessToken")&&U(localStorage.getItem("userAccessToken"))},[c,U]),o.useEffect(()=>{window.scrollTo(0,0)},[]),o.useEffect(()=>{if(h.editAddress)return document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}},[h]),s.jsx(s.Fragment,{children:J?s.jsx(se,{height:"100vh",width:"100%"}):m&&m.length>0?s.jsxs(r,{className:"cart-con",children:[s.jsx(ae,{}),s.jsxs(r,{className:"cart",children:[s.jsx(r,{className:"product-con",children:m.map(e=>{var a,t,n,g,E;return s.jsxs(r,{className:"product",children:[s.jsx(r,{className:"imgBox",children:s.jsx("img",{src:`${(a=e==null?void 0:e.productId)==null?void 0:a.productImgUrls[0]}`,alt:`${(t=e==null?void 0:e.productId)==null?void 0:t.name}`})}),s.jsxs(r,{className:"product-info",children:[s.jsx(te,{title:`${(n=e==null?void 0:e.productId)==null?void 0:n.name}`}),s.jsxs(r,{className:"size",children:[s.jsx("label",{htmlFor:"size",children:"size - "}),s.jsx("select",{name:"size",id:"size",value:e==null?void 0:e.size,onChange:d=>H(e==null?void 0:e._id,d.target.value),children:e==null?void 0:e.productId.sizes.map(d=>s.jsx("option",{value:`${d}`,children:d},`${d}`))})]}),s.jsxs(r,{className:"cloth-color",children:[s.jsx("h3",{className:"dark",children:"color -"}),s.jsx("h3",{children:(g=e==null?void 0:e.productId)==null?void 0:g.color})]}),s.jsxs(r,{className:"p",children:[s.jsx(oe,{className:"delete",onClick:()=>G(e==null?void 0:e._id)}),s.jsxs("h3",{children:["INR ",(E=e==null?void 0:e.productId)==null?void 0:E.price]})]})]})]},`${e==null?void 0:e._id}`)})}),s.jsx(r,{className:"user-info-container",children:s.jsxs(r,{className:"price-con",children:[s.jsx(r,{className:"price-sub-div",children:s.jsxs("form",{className:"user-info-con",children:[s.jsxs(r,{className:"user-info-field-con",children:[s.jsx("label",{htmlFor:"email-Id",children:"Email"}),s.jsxs(r,{className:"user-info-field",children:[s.jsx(j,{type:"text",name:"email",value:f.email,onChange:D,placeholder:"enter your email",id:"email-Id",disabled:!h.editEmail}),h.editEmail?s.jsx("button",{type:"button",onClick:()=>F(),className:"cart-btn",children:"save"}):s.jsx(k,{onClick:()=>l("editEmail"),className:"cart-icon"})]})]}),s.jsxs(r,{className:"user-info-field-con",children:[s.jsx("label",{htmlFor:"phoneNo",children:"Phone No"}),s.jsxs(r,{className:"user-info-field",children:[s.jsx(j,{type:"text",name:"phoneNo",value:f.phoneNo,onChange:D,placeholder:"enter 10 digit phone no",id:"phoneNo",disabled:!h.editPhoneNo}),h.editPhoneNo?s.jsx("button",{type:"button",onClick:()=>F(),className:"cart-btn",children:"save"}):s.jsx(k,{onClick:()=>l("editPhoneNo"),className:"cart-icon"})]})]}),s.jsxs(r,{className:"user-info-field-con",children:[s.jsxs(r,{className:"address-label-con",children:[s.jsx("label",{htmlFor:"address",children:"Delivery Address"}),s.jsx(re,{className:"icon",onClick:()=>l("editAddress")})]}),N&&N.length>0?N.map(e=>s.jsxs(r,{className:"user-info-field",children:[s.jsx(j,{type:"text",name:"address",value:q(e),placeholder:"enter your address",disabled:!0,id:"address"}),s.jsx(k,{onClick:()=>l("editAddress",e),className:"cart-icon"}),s.jsx(r,{className:"radio",children:s.jsx(j,{type:"radio",name:"deliveryAddress",checked:e._id===b,value:e._id,onChange:a=>y(a.target.value)})})]},e._id)):null]})]})}),s.jsxs(r,{className:"sub-con",children:[s.jsxs(r,{className:"discount-box",children:[s.jsx(j,{type:"text",placeholder:"add discount code",name:"discount",required:!0}),s.jsx("button",{className:"discount-btn",children:"apply"})]}),s.jsxs(r,{className:"sub-total",children:[s.jsx("h3",{children:"subtotal"}),s.jsxs("h3",{children:["inr ",x.productAmount]})]}),s.jsxs(r,{className:"shipping-cost",children:[s.jsx("h3",{children:"shipping cost"}),s.jsx("h3",{children:x.shippingAmount})]}),s.jsxs(r,{className:"total",children:[s.jsx("h2",{children:"total"}),s.jsxs("h2",{children:["inr ",x.productAmount]})]})]}),s.jsx("button",{type:"button",className:"checkout-btn",onClick:()=>K(f,N),children:"CHECKOUT"})]})})]}),h.editAddress&&s.jsx(r,{className:"address-form-con1",children:s.jsx(ne,{handleEdit:l,saveAddress:A!==""?M:Q,editAddress:A!=="",addressObj:$,setAddress:v})})]}):s.jsxs(r,{className:"empty-cart",children:[s.jsx("h2",{children:"Cart is empty add exciting products"}),s.jsx(ie,{to:"/",className:"empty-cart-link",children:s.jsx("h2",{children:"Go to home page "})})]})})}export{me as default};
