import{r,b as F,a as J,f as q,u as G,i as H,k as K,j as s,C as o,S as Q,T as n,l as V,m as b,c as X,n as Y,o as d}from"./index-Dw_2fx3G.js";import{P as Z,s as ss}from"./slugToStr-ZFj36Q6u.js";import{C as ts}from"./index-DMkX-zaC.js";function os(){const[a,N]=r.useState(null),[S,w]=r.useState(""),[u,m]=r.useState(""),[p,T]=r.useState(null),[h,z]=r.useState(null),[A,f]=r.useState(!0),[E,x]=r.useState(!1),[L,g]=r.useState(!1),[$,_]=r.useState(window.innerWidth<=567),{productName:i}=F()||"",j=J(),k=q(),{accessToken:l,setAccessToken:P}=G(),{userInfo:y,setUserInfo:v}=H(),{cartInfo:C,setCartInfo:W}=K(),U=t=>{t.target.innerText===u?m(""):m(t.target.innerText)},D=t=>{w(t.target.src)},R=async()=>await fetch("https://looks.akash-pathak.xyz/api/cart/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({productId:a._id,quantity:1,size:u})}),M=async()=>{try{if(u){const t=await R(),e=await t.json();if(t.status===403)return j("/account/login",{state:{from:k}});e.cart!==null&&t.status===200?(W(e.cart),d.success("Product added to the cart")):t.status===400&&d.success("Product already added to cart ")}else d.error("Please select a size")}catch(t){console.log("error in adding item to cart",t)}},O=async t=>{try{if(!l)j("/account/login",{state:{from:k}});else{const e=await fetch("https://looks.akash-pathak.xyz/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({wishlistId:t,wishlistAction:"save"})}),c=await e.json();e.status===200&&(v(c.userData),d.success("Product added to wishlist"))}}catch(e){d.error("error : ",e)}};r.useEffect(()=>{i&&(async()=>{try{if(m(""),f(!0),i){const e=ss(i),c=await fetch(`https://looks.akash-pathak.xyz/api/product?name=${e}`),I=await c.json();c.status===200&&(w(I.products[0].productImgUrls[0]),N(I.products[0]),z(I.products[0].categoryId),f(!1))}}catch(e){console.log("error:",e)}})()},[i]),r.useEffect(()=>{h&&(async()=>{try{if(h){const c=await(await fetch(`https://looks.akash-pathak.xyz/api/product/filter?categoryId=${h._id}`)).json();c!==null&&T(c),f(!1)}}catch(e){console.log("error:",e)}})()},[h,i]),r.useEffect(()=>{if(y!==null&&a!==null){const t=y.wishlist.some(e=>e._id===a._id);x(!!t)}else x(!1)},[y,a]),r.useEffect(()=>{if(C!==null&&a!==null){const t=C.products.some(e=>e.productId._id===a._id);g(!!t)}else g(!1)},[C,a]),r.useEffect(()=>{!l&&localStorage.getItem("userAccessToken")&&P(localStorage.getItem("userAccessToken"))},[l,P]);const B=()=>{j("/cart")};return r.useEffect(()=>{window.scrollTo(0,0)},[i]),r.useEffect(()=>{const t=()=>{_(window.innerWidth<=567)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[]),s.jsx(o,{className:"product-page-con",children:A?s.jsx(Q,{height:"90vh",width:"100%"}):s.jsxs(s.Fragment,{children:[s.jsxs(o,{className:"productPage",children:[$?s.jsx(ts,{showDots:!0,wrapMode:"wrap",children:a.productImgUrls.map((t,e)=>s.jsx("div",{className:"slide",children:s.jsx("img",{src:t})},e))}):s.jsxs(o,{className:"product-img-sec",children:[s.jsx(o,{className:"img-sub-sec1",children:a.productImgUrls.map((t,e)=>s.jsx("img",{src:t,onClick:D},e))}),s.jsx(o,{className:"img-sub-sec2",children:s.jsx("img",{src:`${S}`})})]}),s.jsxs(o,{className:"product-info-sec",children:[s.jsx("h1",{className:"name",children:a.name.toUpperCase()}),s.jsxs(o,{className:"price",children:[s.jsx(n,{title:`Inr ${a.price}`}),s.jsx("h3",{children:"incl. all taxes"})]}),s.jsxs(o,{className:"description",children:[s.jsx(n,{title:"description"}),s.jsx("h3",{children:a.description})]}),s.jsxs(o,{className:"wash-care",children:[s.jsx(n,{title:"Wash Care"}),s.jsx("h3",{children:"machine wash"})]}),s.jsxs(o,{className:"material-type",children:[s.jsx(n,{title:"Material Type"}),s.jsx("h3",{children:a.materialType})]}),s.jsxs(o,{className:"size-sec",children:[s.jsx(n,{title:"Sizes"}),s.jsx("ul",{className:"size",children:a.sizes.map((t,e)=>s.jsx("li",{className:"pointer",onClick:U,style:u===`${t}`?{backgroundColor:"grey"}:null,children:t},e))})]}),s.jsxs(o,{className:"button-box",children:[s.jsxs("button",{type:"button",className:"button1",onClick:()=>O(a._id),children:[s.jsx(V,{style:E?{color:"red",marginRight:"10px"}:{color:"white",marginRight:"10px"},size:24}),"WishList"]}),L?s.jsxs("button",{type:"button",className:"button2 cartbtn",style:{backgroundColor:"#87CEFA"},onClick:B,children:[s.jsx(b,{style:{color:"black",marginRight:"8px"}}),"Go to Cart"]}):s.jsxs("button",{type:"button",className:"button2",onClick:M,children:[s.jsx(b,{style:{color:"black",marginRight:"8px"}}),"Add to Cart"]})]})]})]}),s.jsxs(o,{className:"recommendation-sec",children:[s.jsx(n,{className:"title",title:"Similar Products"}),s.jsx(o,{className:"product-column",children:p&&p.length>0?p.map(t=>{if(t._id!==a._id)return s.jsx(Z,{data:t,type:"productList",route:`/product/${X(t.name)}`},t._id)}):"nothing to show"}),s.jsx(Y,{})]})]})})}export{os as default};
