import{r,a as W,f as D,c as O,u as R,g as v,h as B,j as s,C as a,S as J,i as q,n as d}from"./index-DdXbiFkB.js";import{L as F}from"./index-BZK8ynW6.js";import{T as n}from"./Title-XAzlc8PW.js";import{c as H}from"./createSlug-_5_DawpL.js";import{P as M,s as G}from"./slugToStr-CcCuq8jT.js";function Z(){const[c,S]=r.useState(null),[C,y]=r.useState(""),[u,m]=r.useState(""),[p,T]=r.useState(null),[h,w]=r.useState(null),[b,f]=r.useState(!0),[$,g]=r.useState(!1),{productName:i}=W()||"",N=D(),I=O(),{accessToken:l,setAccessToken:P}=R(),{userInfo:x,setUserInfo:k}=v(),{setCartInfo:A}=B(),L=t=>{t.target.innerText===u?m(""):m(t.target.innerText)},z=t=>{y(t.target.src)},_=async()=>await fetch("http://localhost:3000/api/cart/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({productId:c._id,quantity:1,size:u})}),E=async()=>{try{if(u){const t=await _(),e=await t.json();if(t.status===403)return N("/account/login",{state:{from:I}});e.cart!==null&&t.status===200?(A(e.cart),d.success("Product added to the cart")):t.status===400&&d.success("Product already added to cart ")}else d.error("Please select a size")}catch(t){console.log("error in adding item to cart",t)}},U=async t=>{try{if(!l)N("/account/login",{state:{from:I}});else{const e=await fetch("http://localhost:3000/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({wishlistId:t,wishlistAction:"save"})}),o=await e.json();e.status===200&&(k(o.userData),d.success("Product added to wishlist"))}}catch(e){d.error("error : ",e)}};return r.useEffect(()=>{i&&(async()=>{try{if(m(""),f(!0),i){const e=G(i),o=await fetch(`http://localhost:3000/api/product?name=${e}`),j=await o.json();o.status===200&&(y(j.products[0].productImgUrls[0]),S(j.products[0]),w(j.products[0].categoryId),console.log("aka"),f(!1))}}catch(e){console.log("error:",e)}})()},[i]),r.useEffect(()=>{h&&(async()=>{try{if(h){const o=await(await fetch(`http://localhost:3000/api/product/filter?categoryId=${h._id}`)).json();o!==null&&T(o),f(!1)}}catch(e){console.log("error:",e)}})()},[h,i]),r.useEffect(()=>{if(x!==null&&c!==null){const t=x.wishlist.some(e=>e._id===c._id);g(!!t)}else g(!1)},[x,c]),r.useEffect(()=>{!l&&localStorage.getItem("userAccessToken")&&P(localStorage.getItem("userAccessToken"))},[l,P]),r.useEffect(()=>{window.scrollTo(0,0)},[i]),s.jsx(a,{className:"product-page-con",children:b?s.jsx(J,{}):s.jsxs(s.Fragment,{children:[s.jsxs(a,{className:"productPage",children:[s.jsxs(a,{className:"product-img-sec",children:[s.jsx(a,{className:"img-sub-sec1",children:c.productImgUrls.map((t,e)=>s.jsx("img",{src:t,onClick:z},e))}),s.jsx(a,{className:"img-sub-sec2",children:s.jsx("img",{src:`${C}`})})]}),s.jsxs(a,{className:"product-info-sec",children:[s.jsx("h1",{className:"name",children:c.name.toUpperCase()}),s.jsxs(a,{className:"price",children:[s.jsx(n,{title:`Inr ${c.price}`}),s.jsx("h3",{children:"incl. all taxes"})]}),s.jsxs(a,{className:"description",children:[s.jsx(n,{title:"description"}),s.jsx("h3",{children:c.description})]}),s.jsxs(a,{className:"wash-care",children:[s.jsx(n,{title:"Wash Care"}),s.jsx("h3",{children:"machine wash"})]}),s.jsxs(a,{className:"material-type",children:[s.jsx(n,{title:"Material Type"}),s.jsx("h3",{children:c.materialType})]}),s.jsxs(a,{className:"size-sec",children:[s.jsx(n,{title:"Sizes"}),s.jsx("ul",{className:"size",children:c.sizes.map((t,e)=>s.jsx("li",{className:"pointer",onClick:L,style:u===`${t}`?{backgroundColor:"grey"}:null,children:t},e))})]}),s.jsxs(a,{className:"button-box",children:[s.jsxs("button",{type:"button",className:"button1",onClick:()=>U(c._id),children:[s.jsx(F,{style:$?{color:"red",marginRight:"10px"}:{color:"white",marginRight:"10px"},size:24}),"WishList"]}),s.jsx("button",{type:"button",className:"button2",onClick:E,children:"Add to Cart"})]})]})]}),s.jsxs(a,{className:"recommendation-sec",children:[s.jsx(n,{className:"title",title:"Similar Products"}),s.jsx(a,{className:"product-column",children:p&&p.length>0?p.map(t=>{if(t._id!==c._id)return s.jsx(M,{data:t,type:"productList",route:`/product/${H(t.name)}`},t._id)}):"nothing to show"}),s.jsx(q,{})]})]})})}export{Z as default};
