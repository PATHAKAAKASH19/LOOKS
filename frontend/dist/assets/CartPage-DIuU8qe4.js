import{a as X,r as i,u as Y,k as Z,i as ee,j as s,S as se,C as r,n as ae,T as te,e as f,p as T,q as re,A as ne,L as oe,o}from"./index-Dw_2fx3G.js";import{R as ie}from"./index-DKGqeXoN.js";function me(){const L=X(),[h,R]=i.useState({editEmail:!1,editAddress:!1,editPhoneNo:!1}),[A,w]=i.useState(""),[k,j]=i.useState(""),[x,_]=i.useState({shippingAmount:"",productAmount:"",netAmount:""}),[J,P]=i.useState(!1),[m,O]=i.useState([]),[p,b]=i.useState({name:"",email:"",phoneNo:""}),[I,z]=i.useState(null),[N,$]=i.useState([]),{accessToken:c,setAccessToken:U}=Y(),{cartInfo:v,setCartInfo:C}=Z(),{userInfo:u,setUserInfo:B}=ee(),q=e=>Object.entries(e).filter(([t])=>t!=="_id").map(([,t])=>t).join(", "),K=async(e,a)=>{try{if(e.phoneNo,e.email,k){const t=a.filter(y=>k===y._id),{_id:n,...g}=t[0],d=await(await fetch("https://looks.akash-pathak.xyz/api/order/checkout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({address:g})})).json(),V={key:"rzp_test_QoUrFERqmNoDNk",amount:d.amount,currency:"INR",name:"Looks Pvt Ltd",description:"Test Transction",order_id:d.razorpayOrderId,handler:async function(y){try{const E=await fetch(`https://looks.akash-pathak.xyz/api/order/verify/${d.orderId}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({order_id:y.razorpay_order_id,payment_id:y.razorpay_payment_id,signature:y.razorpay_signature})}),W=await E.json();E.status===200?(C(null),L(`/paymentSuccess?reference=${W.orderId}`)):o.error("Payment failed, retry")}catch{o.error("Please try again")}},prefill:{name:`${e.name}`,email:`${e.email}`,contact:`${e.phoneNo}`},notes:{orderId:`${d.orderId}`,customerId:`${e._id}`},theme:{color:"#528FF0"}};new window.Razorpay(V).open()}else o.error("Please fill email, phoneNo and address")}catch{o.error("Could not initiate payment. Please try again.")}},H=async(e,a)=>{try{const t=await fetch("https://looks.akash-pathak.xyz/api/cart/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({productId:e,size:a,quantity:1})}),{cart:n}=await t.json();t.status===200&&n!==null?(C(n),o.success("size updated successfully")):n===null&&o.error("select different size")}catch(t){o.error("error : ",t)}},G=async e=>{try{const a=await fetch("https://looks.akash-pathak.xyz/api/cart/",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({productId:e})}),t=await a.json();a.status===200&&(C(t.cart),o.success(`${t.message}`))}catch{o.error("please delete again")}};i.useEffect(()=>{if(m&&m.length>0){const e=[];m.forEach(t=>{var n;e.push((n=t.productId)==null?void 0:n.price)});const a=e.reduce((t,n)=>t+n);a<=499?_({shippingAmount:"inr 150",productAmount:`${a}`,netAmount:`${Number(a)+150}`}):_({shippingAmount:"FREE",productAmount:`${a}`,netAmount:`${a}`})}},[m]),i.useEffect(()=>{var e;if(c&&v&&u){P(!0);const{address:a,wishlist:t,...n}=u;O(v.products),b({...n}),$(a),j((e=u==null?void 0:u.address[0])==null?void 0:e._id),P(!1)}else O([]),b({name:"",email:"",phoneNo:""}),$([]),j(null)},[c,v,u]);const l=(e,a)=>{R(t=>({...t,[e]:!t[e]})),a?(z(a),w(`${a._id}`)):(z(null),w(""))},D=e=>{b(a=>({...a,[e.target.name]:e.target.value}))},Q=async e=>{var a;try{e.preventDefault();const t=await fetch("https://looks.akash-pathak.xyz/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({address:I,addressAction:"save"})}),{userData:n}=await t.json();t.status===200&&($(n.address),l("editAddress"),o.success("address created successfully"),j((a=n.address[0])==null?void 0:a._id))}catch(t){o.error("error:",t)}},M=async e=>{try{e.preventDefault();const a=await fetch("https://looks.akash-pathak.xyz/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({address:I,prevAddressId:A})}),{userData:t}=await a.json();a.status===200&&(B(t),l("editAddress"),o.success("address updated successfully"))}catch(a){o.error("error : ",a)}},F=async()=>{try{const e=await fetch("https://looks.akash-pathak.xyz/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({email:p.email,phoneNo:p.phoneNo})}),a=await e.json();e.status===200&&(B(a.userData),o.success("userInfo save successfully"),h.editEmail?l("editEmail"):l("editPhoneNo"))}catch(e){o.error("error : ",e)}};return i.useEffect(()=>{!c&&localStorage.getItem("userAccessToken")&&U(localStorage.getItem("userAccessToken"))},[c,U]),i.useEffect(()=>{window.scrollTo(0,0)},[]),i.useEffect(()=>{if(h.editAddress)return document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}},[h]),s.jsx(s.Fragment,{children:J?s.jsx(se,{height:"100vh",width:"100%"}):m&&m.length>0?s.jsxs(r,{className:"cart-con",children:[s.jsx(ae,{}),s.jsxs(r,{className:"cart",children:[s.jsx(r,{className:"product-con",children:m.map(e=>{var a,t,n,g,S;return s.jsxs(r,{className:"product",children:[s.jsx(r,{className:"imgBox",children:s.jsx("img",{src:`${(a=e==null?void 0:e.productId)==null?void 0:a.productImgUrls[0]}`,alt:`${(t=e==null?void 0:e.productId)==null?void 0:t.name}`})}),s.jsxs(r,{className:"product-info",children:[s.jsx(te,{title:`${(n=e==null?void 0:e.productId)==null?void 0:n.name}`}),s.jsxs(r,{className:"size",children:[s.jsx("label",{htmlFor:"size",children:"size - "}),s.jsx("select",{name:"size",id:"size",value:e==null?void 0:e.size,onChange:d=>H(e==null?void 0:e._id,d.target.value),children:e==null?void 0:e.productId.sizes.map(d=>s.jsx("option",{value:`${d}`,children:d},`${d}`))})]}),s.jsxs(r,{className:"cloth-color",children:[s.jsx("h3",{className:"dark",children:"color -"}),s.jsx("h3",{children:(g=e==null?void 0:e.productId)==null?void 0:g.color})]}),s.jsxs(r,{className:"p",children:[s.jsx(ie,{className:"delete",onClick:()=>G(e==null?void 0:e._id)}),s.jsxs("h3",{children:["INR ",(S=e==null?void 0:e.productId)==null?void 0:S.price]})]})]})]},`${e==null?void 0:e._id}`)})}),s.jsx(r,{className:"user-info-container",children:s.jsxs(r,{className:"price-con",children:[s.jsx(r,{className:"price-sub-div",children:s.jsxs("form",{className:"user-info-con",children:[s.jsxs(r,{className:"user-info-field-con",children:[s.jsx("label",{htmlFor:"email-Id",children:"Email"}),s.jsxs(r,{className:"user-info-field",children:[s.jsx(f,{type:"text",name:"email",value:p.email,onChange:D,placeholder:"enter your email",id:"email-Id",disabled:!h.editEmail}),h.editEmail?s.jsx("button",{type:"button",onClick:()=>F(),className:"cart-btn",children:"save"}):s.jsx(T,{onClick:()=>l("editEmail"),className:"cart-icon"})]})]}),s.jsxs(r,{className:"user-info-field-con",children:[s.jsx("label",{htmlFor:"phoneNo",children:"Phone No"}),s.jsxs(r,{className:"user-info-field",children:[s.jsx(f,{type:"text",name:"phoneNo",value:p.phoneNo,onChange:D,placeholder:"enter 10 digit phone no",id:"phoneNo",disabled:!h.editPhoneNo}),h.editPhoneNo?s.jsx("button",{type:"button",onClick:()=>F(),className:"cart-btn",children:"save"}):s.jsx(T,{onClick:()=>l("editPhoneNo"),className:"cart-icon"})]})]}),s.jsxs(r,{className:"user-info-field-con",children:[s.jsxs(r,{className:"address-label-con",children:[s.jsx("label",{htmlFor:"address",children:"Delivery Address"}),s.jsx(re,{className:"icon",onClick:()=>l("editAddress")})]}),N&&N.length>0?N.map(e=>s.jsxs(r,{className:"user-info-field",children:[s.jsx(f,{type:"text",name:"address",value:q(e),placeholder:"enter your address",disabled:!0,id:"address"}),s.jsx(T,{onClick:()=>l("editAddress",e),className:"cart-icon"}),s.jsx(r,{className:"radio",children:s.jsx(f,{type:"radio",name:"deliveryAddress",checked:e._id===k,value:e._id,onChange:a=>j(a.target.value)})})]},e._id)):null]})]})}),s.jsxs(r,{className:"sub-con",children:[s.jsxs(r,{className:"discount-box",children:[s.jsx(f,{type:"text",placeholder:"add discount code",name:"discount",required:!0}),s.jsx("button",{className:"discount-btn",children:"apply"})]}),s.jsxs(r,{className:"sub-total",children:[s.jsx("h3",{children:"subtotal"}),s.jsxs("h3",{children:["inr ",x.productAmount]})]}),s.jsxs(r,{className:"shipping-cost",children:[s.jsx("h3",{children:"shipping cost"}),s.jsx("h3",{children:x.shippingAmount})]}),s.jsxs(r,{className:"total",children:[s.jsx("h2",{children:"total"}),s.jsxs("h2",{children:["inr ",x.productAmount]})]})]}),s.jsx("button",{type:"button",className:"checkout-btn",onClick:()=>K(p,N),children:"CHECKOUT"})]})})]}),h.editAddress&&s.jsx(r,{className:"address-form-con1",children:s.jsx(ne,{handleEdit:l,saveAddress:A!==""?M:Q,editAddress:A!=="",addressObj:I,setAddress:z})})]}):s.jsxs(r,{className:"empty-cart",children:[s.jsx("h2",{children:"Cart is empty add exciting products"}),s.jsx(oe,{to:"/",className:"empty-cart-link",children:s.jsx("h2",{children:"Go to home page "})})]})})}export{me as default};
