import{a as V,r as i,u as W,j as e,S as Y,C as r,f as ee,I as f,L as se,n as o}from"./index-qZzDzbZj.js";import{b as ae}from"./index-BaTChy37.js";import{T as te}from"./Title-CTVzQ9qW.js";import{R as re}from"./index-BfQDK_gM.js";import{C as E}from"./index-DRhMxtQ4.js";import{A as ne}from"./AddressForm-CSpIVcVg.js";import{u as oe}from"./cartContext-DNF5_Ldd.js";import{u as ie}from"./UserInfoContext-HTiHrqoD.js";import"./index-DZQUvU2G.js";function ye(){const D=V(),[m,R]=i.useState({editEmail:!1,editAddress:!1,editPhoneNo:!1}),[A,_]=i.useState(""),[k,b]=i.useState(""),[x,P]=i.useState({shippingAmount:"",productAmount:"",netAmount:""}),[J,T]=i.useState(!1),[l,X]=i.useState([]),[p,w]=i.useState({name:"",email:"",phoneNo:""}),[I,C]=i.useState(null),[y,O]=i.useState([]),{accessToken:c}=W(),{cartInfo:z,setCartInfo:L}=oe(),{userInfo:u,setUserInfo:U}=ie(),q=s=>Object.entries(s).filter(([t])=>t!=="_id").map(([,t])=>t).join(", "),K=async(s,a)=>{try{if(s.phoneNo,s.email,k){const t=a.filter(j=>k===j._id),{_id:n,...N}=t[0],h=await(await fetch("https://looks.akash-pathak.xyz/api/order/checkout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({address:N})})).json(),$={key:"rzp_test_QoUrFERqmNoDNk",amount:h.amount,currency:"INR",name:"Looks Pvt Ltd",description:"Test Transction",order_id:h.razorpayOrderId,handler:async function(j){try{const g=await fetch(`/api/order/verify/${h.orderId}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({order_id:j.razorpay_order_id,payment_id:j.razorpay_payment_id,signature:j.razorpay_signature})}),Z=await g.json();g.status===200?D(`/paymentSuccess?reference=${Z.orderId}`):o.error("Payment failed, retry")}catch(g){console.log("Error",g),o.error("Please try again")}},prefill:{name:`${s.name}`,email:`${s.email}`,contact:`${s.phoneNo}`},notes:{orderId:`${h.orderId}`,customerId:`${s._id}`},theme:{color:"#528FF0"}};new window.Razorpay($).open()}else o.error("Please fill email, phoneNo and address")}catch(t){console.log("error",t),o.error("Could not initiate payment. Please try again.")}},H=async(s,a)=>{try{const t=await fetch("https://looks.akash-pathak.xyz/api/cart/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({productId:s,size:a,quantity:1})}),{cart:n}=await t.json();t.status===200&&n!==null?(L(n),o.success("size updated successfully")):n===null&&o.error("select different size")}catch(t){o.error("error : ",t)}},M=async s=>{try{const a=await fetch("https://looks.akash-pathak.xyz/api/cart/",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({productId:s})}),t=await a.json();a.status===200&&(L(t.cart),o.success(`${t.message}`))}catch(a){console.log("error",a),o.error("please delete again")}};i.useEffect(()=>{if(l&&l.length>0){const s=[];l.forEach(t=>{var n;s.push((n=t.productId)==null?void 0:n.price)});const a=s.reduce((t,n)=>t+n);a<=499?P({shippingAmount:"inr 150",productAmount:`${a}`,netAmount:`${Number(a)+150}`}):P({shippingAmount:"FREE",productAmount:`${a}`,netAmount:`${a}`})}},[l]),i.useEffect(()=>{var s;if(c&&z&&u){T(!0);const{address:a,wishlist:t,...n}=u;X(z.products),w({...n}),O(a),b((s=u==null?void 0:u.address[0])==null?void 0:s._id),T(!1)}},[c,z,u,l]);const d=(s,a)=>{R(t=>({...t,[s]:!t[s]})),a?(C(a),_(`${a._id}`)):(C(null),_(""))},B=s=>{w(a=>({...a,[s.target.name]:s.target.value}))},G=async s=>{var a;try{s.preventDefault();const t=await fetch("https://looks.akash-pathak.xyz/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({address:I,addressAction:"save"})}),{userData:n}=await t.json();t.status===200&&(O(n.address),d("editAddress"),o.success("address created successfully"),b((a=n.address[0])==null?void 0:a._id))}catch(t){o.error("error:",t)}},Q=async s=>{try{s.preventDefault();const a=await fetch("https://looks.akash-pathak.xyz/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({address:I,prevAddressId:A})}),{userData:t}=await a.json();a.status===200&&(U(t),d("editAddress"),o.success("address updated successfully"))}catch(a){o.error("error : ",a)}},F=async()=>{try{const s=await fetch("https://looks.akash-pathak.xyz/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({email:p.email,phoneNo:p.phoneNo})}),a=await s.json();s.status===200&&(U(a.userData),o.success("userInfo save successfully"),m.editEmail?d("editEmail"):d("editPhoneNo"))}catch(s){o.error("error : ",s)}};return i.useEffect(()=>{window.scrollTo(0,0)},[]),e.jsx(e.Fragment,{children:J?e.jsx(Y,{}):l&&l.length>0?e.jsxs(r,{className:"cart-con",children:[e.jsx(ee,{}),e.jsxs(r,{className:"cart",children:[e.jsx(r,{className:"product-con",children:l.map(s=>{var a,t,n,N,v,h,S;return e.jsxs(r,{className:"product",children:[e.jsx(r,{className:"imgBox",children:e.jsx("img",{src:`${(a=s==null?void 0:s.productId)==null?void 0:a.productImgUrls[0]}`,alt:`${(t=s==null?void 0:s.productId)==null?void 0:t.name}`})}),e.jsxs(r,{className:"product-info",children:[e.jsx(te,{title:`${(n=s==null?void 0:s.productId)==null?void 0:n.name.toUpperCase()}`}),e.jsxs(r,{className:"size",children:[e.jsx("label",{htmlFor:"size",children:"SIZE - "}),e.jsxs("select",{name:"size",id:"size",value:(N=s==null?void 0:s.size)==null?void 0:N.toUpperCase(),onChange:$=>H(s==null?void 0:s._id,$.target.value),children:[e.jsx("option",{value:"S",children:"S"}),e.jsx("option",{value:"M",children:"M"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"XL",children:"XL"}),e.jsx("option",{value:"XLL",children:"XXL"})]})]}),e.jsxs(r,{className:"cloth-color",children:[e.jsx("h3",{className:"dark",children:"COLOR -"}),e.jsx("h3",{children:(h=(v=s==null?void 0:s.productId)==null?void 0:v.color)==null?void 0:h.toUpperCase()})]}),e.jsxs(r,{className:"p",children:[e.jsx(re,{className:"delete",onClick:()=>M(s==null?void 0:s._id)}),e.jsxs("h3",{children:["INR ",(S=s==null?void 0:s.productId)==null?void 0:S.price]})]})]})]},`${s==null?void 0:s._id}`)})}),e.jsx(r,{className:"user-info-container",children:e.jsxs(r,{className:"price-con",children:[e.jsx(r,{className:"price-sub-div",children:e.jsxs("form",{className:"user-info-con",children:[e.jsxs(r,{className:"user-info-field-con",children:[e.jsx("label",{htmlFor:"email-Id",children:"Email"}),e.jsxs(r,{className:"user-info-field",children:[e.jsx(f,{type:"text",name:"email",value:p.email,onChange:B,placeholder:"enter your email",id:"email-Id",disabled:!m.editEmail}),m.editEmail?e.jsx("button",{type:"button",onClick:()=>F(),className:"cart-btn",children:"save"}):e.jsx(E,{onClick:()=>d("editEmail"),className:"cart-icon"})]})]}),e.jsxs(r,{className:"user-info-field-con",children:[e.jsx("label",{htmlFor:"phoneNo",children:"Phone No"}),e.jsxs(r,{className:"user-info-field",children:[e.jsx(f,{type:"text",name:"phoneNo",value:p.phoneNo,onChange:B,placeholder:"enter 10 digit phone no",id:"phoneNo",disabled:!m.editPhoneNo}),m.editPhoneNo?e.jsx("button",{type:"button",onClick:()=>F(),className:"cart-btn",children:"save"}):e.jsx(E,{onClick:()=>d("editPhoneNo"),className:"cart-icon"})]})]}),e.jsxs(r,{className:"user-info-field-con",children:[e.jsxs(r,{className:"address-label-con",children:[e.jsx("label",{htmlFor:"address",children:"delivery Address"}),e.jsx(ae,{className:"icon",onClick:()=>d("editAddress")})]}),y&&y.length>0?y.map(s=>e.jsxs(r,{className:"user-info-field",children:[e.jsx(f,{type:"text",name:"address",value:q(s),placeholder:"enter your address",disabled:!0,id:"address"}),e.jsx(E,{onClick:()=>d("editAddress",s),className:"cart-icon"}),e.jsx(r,{className:"radio",children:e.jsx(f,{type:"radio",name:"deliveryAddress",checked:s._id===k,value:s._id,onChange:a=>b(a.target.value)})})]},s._id)):null]})]})}),e.jsxs(r,{className:"sub-con",children:[e.jsxs(r,{className:"discount-box",children:[e.jsx(f,{type:"text",placeholder:"add discount code",name:"discount",required:!0}),e.jsx("button",{className:"discount-btn",children:"apply"})]}),e.jsxs(r,{className:"sub-total",children:[e.jsx("h3",{children:"subtotal"}),e.jsxs("h3",{children:["inr ",x.productAmount]})]}),e.jsxs(r,{className:"shipping-cost",children:[e.jsx("h3",{children:"shipping cost"}),e.jsx("h3",{children:x.shippingAmount})]}),e.jsxs(r,{className:"total",children:[e.jsx("h2",{children:"total"}),e.jsxs("h2",{children:["inr ",x.productAmount]})]})]}),e.jsx("button",{type:"button",className:"checkout-btn",onClick:()=>K(p,y),children:"CHECKOUT"})]})})]}),m.editAddress&&e.jsx(r,{className:"address-form-con1",children:e.jsx(ne,{handleEdit:d,saveAddress:A!==""?Q:G,editAddress:A!=="",addressObj:I,setAddress:C})})]}):e.jsxs(r,{className:"empty-cart",children:[e.jsx("h2",{children:"Cart is empty add exciting products"}),e.jsx(se,{to:"/",className:"empty-cart-link",children:e.jsx("h2",{children:"Go to home page "})})]})})}export{ye as default};
