import{a as V,r as i,u as W,j as e,S as Y,C as r,f as ee,I as f,L as se,n as o}from"./index-DXygbHet.js";import{b as ae}from"./index-DbgWu547.js";import{T as te}from"./Title-Bbl53n5L.js";import{R as re}from"./index-BtvRUOd0.js";import{C as E}from"./index-CU6HXnsv.js";import{A as ne}from"./AddressForm-DLjM_M6D.js";import{u as oe}from"./cartContext-Cv5eQMjI.js";import{u as ie}from"./UserInfoContext-uXsENF6b.js";import"./index-B6xEgzxw.js";function ye(){const D=V(),[m,R]=i.useState({editEmail:!1,editAddress:!1,editPhoneNo:!1}),[A,_]=i.useState(""),[b,I]=i.useState(""),[x,P]=i.useState({shippingAmount:"",productAmount:"",netAmount:""}),[J,T]=i.useState(!1),[l,X]=i.useState([]),[p,w]=i.useState({name:"",email:"",phoneNo:""}),[C,v]=i.useState(null),[y,O]=i.useState([]),{accessToken:c}=W(),{cartInfo:S,setCartInfo:L}=oe(),{userInfo:u,setUserInfo:U}=ie(),q=s=>Object.entries(s).filter(([t])=>t!=="_id").map(([,t])=>t).join(", "),K=async(s,a)=>{try{if(s.phoneNo,s.email,b){const t=a.filter(j=>b===j._id),{_id:n,...N}=t[0],h=await(await fetch("https://looks.akash-pathak.xyz//api/order/checkout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({address:N})})).json(),k={key:"rzp_test_QoUrFERqmNoDNk",amount:h.amount,currency:"INR",name:"Looks Pvt Ltd",description:"Test Transction",order_id:h.razorpayOrderId,handler:async function(j){try{const g=await fetch(`/api/order/verify/${h.orderId}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({order_id:j.razorpay_order_id,payment_id:j.razorpay_payment_id,signature:j.razorpay_signature})}),Z=await g.json();g.status===200?D(`/paymentSuccess?reference=${Z.orderId}`):o.error("Payment failed, retry")}catch(g){console.log("Error",g),o.error("Please try again")}},prefill:{name:`${s.name}`,email:`${s.email}`,contact:`${s.phoneNo}`},notes:{orderId:`${h.orderId}`,customerId:`${s._id}`},theme:{color:"#528FF0"}};new window.Razorpay(k).open()}else o.error("Please fill email, phoneNo and address")}catch(t){console.log("error",t),o.error("Could not initiate payment. Please try again.")}},H=async(s,a)=>{try{const t=await fetch("/api/cart/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({productId:s,size:a,quantity:1})}),{cart:n}=await t.json();t.status===200&&n!==null?(L(n),o.success("size updated successfully")):n===null&&o.error("select different size")}catch(t){o.error("error : ",t)}},M=async s=>{try{const a=await fetch("https://looks.akash-pathak.xyz//api/cart/",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({productId:s})}),t=await a.json();a.status===200&&(L(t.cart),o.success(`${t.message}`))}catch(a){console.log("error",a),o.error("please delete again")}};i.useEffect(()=>{if(l&&l.length>0){const s=[];l.forEach(t=>{var n;s.push((n=t.productId)==null?void 0:n.price)});const a=s.reduce((t,n)=>t+n);a<=499?P({shippingAmount:"inr 150",productAmount:`${a}`,netAmount:`${Number(a)+150}`}):P({shippingAmount:"FREE",productAmount:`${a}`,netAmount:`${a}`})}},[l]),i.useEffect(()=>{var s;if(c&&S&&u){T(!0);const{address:a,wishlist:t,...n}=u;X(S.products),w({...n}),O(a),I((s=u==null?void 0:u.address[0])==null?void 0:s._id),T(!1)}},[c,S,u,l]);const d=(s,a)=>{R(t=>({...t,[s]:!t[s]})),a?(v(a),_(`${a._id}`)):(v(null),_(""))},B=s=>{w(a=>({...a,[s.target.name]:s.target.value}))},G=async s=>{var a;try{s.preventDefault();const t=await fetch("/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({address:C,addressAction:"save"})}),{userData:n}=await t.json();t.status===200&&(O(n.address),d("editAddress"),o.success("address created successfully"),I((a=n.address[0])==null?void 0:a._id))}catch(t){o.error("error:",t)}},Q=async s=>{try{s.preventDefault();const a=await fetch("/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({address:C,prevAddressId:A})}),{userData:t}=await a.json();a.status===200&&(U(t),d("editAddress"),o.success("address updated successfully"))}catch(a){o.error("error : ",a)}},F=async()=>{try{const s=await fetch("/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({email:p.email,phoneNo:p.phoneNo})}),a=await s.json();s.status===200&&(U(a.userData),o.success("userInfo save successfully"),m.editEmail?d("editEmail"):d("editPhoneNo"))}catch(s){o.error("error : ",s)}};return i.useEffect(()=>{window.scrollTo(0,0)},[]),e.jsx(e.Fragment,{children:J?e.jsx(Y,{}):l&&l.length>0?e.jsxs(r,{className:"cart-con",children:[e.jsx(ee,{}),e.jsxs(r,{className:"cart",children:[e.jsx(r,{className:"product-con",children:l.map(s=>{var a,t,n,N,z,h,$;return e.jsxs(r,{className:"product",children:[e.jsx(r,{className:"imgBox",children:e.jsx("img",{src:`${(a=s==null?void 0:s.productId)==null?void 0:a.productImgUrls[0]}`,alt:`${(t=s==null?void 0:s.productId)==null?void 0:t.name}`})}),e.jsxs(r,{className:"product-info",children:[e.jsx(te,{title:`${(n=s==null?void 0:s.productId)==null?void 0:n.name.toUpperCase()}`}),e.jsxs(r,{className:"size",children:[e.jsx("label",{htmlFor:"size",children:"SIZE - "}),e.jsxs("select",{name:"size",id:"size",value:(N=s==null?void 0:s.size)==null?void 0:N.toUpperCase(),onChange:k=>H(s==null?void 0:s._id,k.target.value),children:[e.jsx("option",{value:"S",children:"S"}),e.jsx("option",{value:"M",children:"M"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"XL",children:"XL"}),e.jsx("option",{value:"XLL",children:"XXL"})]})]}),e.jsxs(r,{className:"cloth-color",children:[e.jsx("h3",{className:"dark",children:"COLOR -"}),e.jsx("h3",{children:(h=(z=s==null?void 0:s.productId)==null?void 0:z.color)==null?void 0:h.toUpperCase()})]}),e.jsxs(r,{className:"p",children:[e.jsx(re,{className:"delete",onClick:()=>M(s==null?void 0:s._id)}),e.jsxs("h3",{children:["INR ",($=s==null?void 0:s.productId)==null?void 0:$.price]})]})]})]},`${s==null?void 0:s._id}`)})}),e.jsx(r,{className:"user-info-container",children:e.jsxs(r,{className:"price-con",children:[e.jsx(r,{className:"price-sub-div",children:e.jsxs("form",{className:"user-info-con",children:[e.jsxs(r,{className:"user-info-field-con",children:[e.jsx("label",{htmlFor:"email-Id",children:"Email"}),e.jsxs(r,{className:"user-info-field",children:[e.jsx(f,{type:"text",name:"email",value:p.email,onChange:B,placeholder:"enter your email",id:"email-Id",disabled:!m.editEmail}),m.editEmail?e.jsx("button",{type:"button",onClick:()=>F(),className:"cart-btn",children:"save"}):e.jsx(E,{onClick:()=>d("editEmail"),className:"cart-icon"})]})]}),e.jsxs(r,{className:"user-info-field-con",children:[e.jsx("label",{htmlFor:"phoneNo",children:"Phone No"}),e.jsxs(r,{className:"user-info-field",children:[e.jsx(f,{type:"text",name:"phoneNo",value:p.phoneNo,onChange:B,placeholder:"enter 10 digit phone no",id:"phoneNo",disabled:!m.editPhoneNo}),m.editPhoneNo?e.jsx("button",{type:"button",onClick:()=>F(),className:"cart-btn",children:"save"}):e.jsx(E,{onClick:()=>d("editPhoneNo"),className:"cart-icon"})]})]}),e.jsxs(r,{className:"user-info-field-con",children:[e.jsxs(r,{className:"address-label-con",children:[e.jsx("label",{htmlFor:"address",children:"delivery Address"}),e.jsx(ae,{className:"icon",onClick:()=>d("editAddress")})]}),y&&y.length>0?y.map(s=>e.jsxs(r,{className:"user-info-field",children:[e.jsx(f,{type:"text",name:"address",value:q(s),placeholder:"enter your address",disabled:!0,id:"address"}),e.jsx(E,{onClick:()=>d("editAddress",s),className:"cart-icon"}),e.jsx(r,{className:"radio",children:e.jsx(f,{type:"radio",name:"deliveryAddress",checked:s._id===b,value:s._id,onChange:a=>I(a.target.value)})})]},s._id)):null]})]})}),e.jsxs(r,{className:"sub-con",children:[e.jsxs(r,{className:"discount-box",children:[e.jsx(f,{type:"text",placeholder:"add discount code",name:"discount",required:!0}),e.jsx("button",{className:"discount-btn",children:"apply"})]}),e.jsxs(r,{className:"sub-total",children:[e.jsx("h3",{children:"subtotal"}),e.jsxs("h3",{children:["inr ",x.productAmount]})]}),e.jsxs(r,{className:"shipping-cost",children:[e.jsx("h3",{children:"shipping cost"}),e.jsx("h3",{children:x.shippingAmount})]}),e.jsxs(r,{className:"total",children:[e.jsx("h2",{children:"total"}),e.jsxs("h2",{children:["inr ",x.productAmount]})]})]}),e.jsx("button",{type:"button",className:"checkout-btn",onClick:()=>K(p,y),children:"CHECKOUT"})]})})]}),m.editAddress&&e.jsx(r,{className:"address-form-con1",children:e.jsx(ne,{handleEdit:d,saveAddress:A!==""?Q:G,editAddress:A!=="",addressObj:C,setAddress:v})})]}):e.jsxs(r,{className:"empty-cart",children:[e.jsx("h2",{children:"Cart is empty add exciting products"}),e.jsx(se,{to:"/",className:"empty-cart-link",children:e.jsx("h2",{children:"Go to home page "})})]})})}export{ye as default};
