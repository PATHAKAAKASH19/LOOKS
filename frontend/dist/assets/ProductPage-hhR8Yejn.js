import{r,b as F,a as J,f as q,u as G,i as H,k as K,j as t,C as c,S as Q,T as n,l as V,m as N,c as X,n as Y,o as d}from"./index-Npg09nsS.js";import{P as Z,s as tt}from"./slugToStr-CqHM6mQZ.js";import{C as st}from"./index-BJzjrNYR.js";function ct(){const[a,S]=r.useState(null),[T,w]=r.useState(""),[u,m]=r.useState(""),[p,k]=r.useState(null),[h,z]=r.useState(null),[A,f]=r.useState(!0),[E,x]=r.useState(!1),[L,g]=r.useState(!1),[$,_]=r.useState(window.innerWidth<=567),{productName:i}=F()||"",j=J(),P=q(),{accessToken:l,setAccessToken:b}=G(),{userInfo:y,setUserInfo:v}=H(),{cartInfo:C,setCartInfo:W}=K(),U=s=>{s.target.innerText===u?m(""):m(s.target.innerText)},D=s=>{w(s.target.src)},R=async()=>await fetch("http://192.168.0.104:3000/api/cart/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({productId:a._id,quantity:1,size:u})}),M=async()=>{try{if(u){const s=await R(),e=await s.json();if(s.status===403)return j("/account/login",{state:{from:P}});e.cart!==null&&s.status===200?(W(e.cart),d.success("Product added to the cart")):s.status===400&&d.success("Product already added to cart ")}else d.error("Please select a size")}catch(s){console.log("error in adding item to cart",s)}},O=async s=>{try{if(!l)j("/account/login",{state:{from:P}});else{const e=await fetch("http://192.168.0.104:3000/api/user/",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({wishlistId:s,wishlistAction:"save"})}),o=await e.json();e.status===200&&(v(o.userData),d.success("Product added to wishlist"))}}catch(e){d.error("error : ",e)}};r.useEffect(()=>{i&&(async()=>{try{if(m(""),f(!0),i){const e=tt(i),o=await fetch(`http://192.168.0.104:3000/api/product?name=${e}`),I=await o.json();o.status===200&&(w(I.products[0].productImgUrls[0]),S(I.products[0]),z(I.products[0].categoryId),f(!1))}}catch(e){console.log("error:",e)}})()},[i]),r.useEffect(()=>{h&&(async()=>{try{if(h){const o=await(await fetch(`http://192.168.0.104:3000/api/product/filter?categoryId=${h._id}`)).json();o!==null&&k(o),f(!1)}}catch(e){console.log("error:",e)}})()},[h,i]),r.useEffect(()=>{if(y!==null&&a!==null){const s=y.wishlist.some(e=>e._id===a._id);x(!!s)}else x(!1)},[y,a]),r.useEffect(()=>{if(C!==null&&a!==null){const s=C.products.some(e=>e.productId._id===a._id);g(!!s)}else g(!1)},[C,a]),r.useEffect(()=>{!l&&localStorage.getItem("userAccessToken")&&b(localStorage.getItem("userAccessToken"))},[l,b]);const B=()=>{j("/cart")};return r.useEffect(()=>{window.scrollTo(0,0)},[i]),r.useEffect(()=>{const s=()=>{_(window.innerWidth<=567)};return window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}},[]),t.jsx(c,{className:"product-page-con",children:A?t.jsx(Q,{height:"90vh",width:"100%"}):t.jsxs(t.Fragment,{children:[t.jsxs(c,{className:"productPage",children:[$?t.jsx(st,{showDots:!0,wrapMode:"wrap",children:a.productImgUrls.map((s,e)=>t.jsx("div",{className:"slide",children:t.jsx("img",{src:s})},e))}):t.jsxs(c,{className:"product-img-sec",children:[t.jsx(c,{className:"img-sub-sec1",children:a.productImgUrls.map((s,e)=>t.jsx("img",{src:s,onClick:D},e))}),t.jsx(c,{className:"img-sub-sec2",children:t.jsx("img",{src:`${T}`})})]}),t.jsxs(c,{className:"product-info-sec",children:[t.jsx("h1",{className:"name",children:a.name.toUpperCase()}),t.jsxs(c,{className:"price",children:[t.jsx(n,{title:`Inr ${a.price}`}),t.jsx("h3",{children:"incl. all taxes"})]}),t.jsxs(c,{className:"description",children:[t.jsx(n,{title:"description"}),t.jsx("h3",{children:a.description})]}),t.jsxs(c,{className:"wash-care",children:[t.jsx(n,{title:"Wash Care"}),t.jsx("h3",{children:"machine wash"})]}),t.jsxs(c,{className:"material-type",children:[t.jsx(n,{title:"Material Type"}),t.jsx("h3",{children:a.materialType})]}),t.jsxs(c,{className:"size-sec",children:[t.jsx(n,{title:"Sizes"}),t.jsx("ul",{className:"size",children:a.sizes.map((s,e)=>t.jsx("li",{className:"pointer",onClick:U,style:u===`${s}`?{backgroundColor:"grey"}:null,children:s},e))})]}),t.jsxs(c,{className:"button-box",children:[t.jsxs("button",{type:"button",className:"button1",onClick:()=>O(a._id),children:[t.jsx(V,{style:E?{color:"red",marginRight:"10px"}:{color:"white",marginRight:"10px"},size:24}),"WishList"]}),L?t.jsxs("button",{type:"button",className:"button2 cartbtn",style:{backgroundColor:"#87CEFA"},onClick:B,children:[t.jsx(N,{style:{color:"black",marginRight:"8px"}}),"Go to Cart"]}):t.jsxs("button",{type:"button",className:"button2",onClick:M,children:[t.jsx(N,{style:{color:"black",marginRight:"8px"}}),"Add to Cart"]})]})]})]}),t.jsxs(c,{className:"recommendation-sec",children:[t.jsx(n,{className:"title",title:"Similar Products"}),t.jsx(c,{className:"product-column",children:p&&p.length>0?p.map(s=>{if(s._id!==a._id)return t.jsx(Z,{data:s,type:"productList",route:`/product/${X(s.name)}`},s._id)}):"nothing to show"}),t.jsx(Y,{})]})]})})}export{ct as default};
